var mindb=function(){"use strict";function e(e,t){t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");var n=t.split("."),i=e;return n.forEach(function(e){if(!i.hasOwnProperty(e))throw new Error("Nested property '"+t+"' could not be resolved at '"+e+"' property.");i=i[e]}),i}function t(e,t){e.sort(function(e,i){return n(t,e,i)})}function n(t,n,i){for(var r=t.length,o=0;o<r;++o){var s=t[o],a=void 0,u=void 0;if(s.nested?(a=e(n,s.key),u=e(i,s.key)):(a=n[s.key],u=i[s.key]),a!==u)return(a>u?1:-1)*s.order}return 0}function i(e){var t=[];return e.forEach(function(e){var n="-"===e[0]?-1:1,i=!!e.match(/(\[|\]|\.)/g);t.push({key:e.replace(/(\-|\+)/g,""),order:n,nested:i})}),t}function r(e,t,i,r){for(var o=0,s=e.length-1,a=void 0,u=void 0;;){if(a=o+Math.floor((s-o)/2),0===(u=n(i,t,e[a])))return a;if(u>0){if(a===s)return r?a+1:-1;o+=Math.ceil((s-o+1)/2)}else{if(a===o)return r?a:-1;s-=Math.ceil((s-o+1)/2)}}}function o(e,t,n){var i=r(e,t,n,!0);e.splice(i,0,t)}function s(e,t,n){var i=new y(e,t,n);return new Proxy(i,{get:function(e,t){return t in e?e[t]:"string"==typeof t&&-1!==e.list().indexOf(t)?e.get(t):void 0},set:function(e,t,n){if(t in e)return e[t]=n,!0;throw new Error("Do not dynamically set values on MinDB.Collection.")}})}function a(e,t){var n=new _(e,t);return new Proxy(n,{get:function(e,t){return t in e?e[t]:"string"==typeof t&&-1!==e.list().indexOf(t)?e.get(t):void 0},set:function(e,t,n){if(t in e)return e[t]=n,!0;throw new Error("Do not dynamically set values on MinDB.Database.")}})}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),f=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},h=function(){function e(t,n){c(this,e),this.name=t,this._index=[],this._sortData=n}return l(e,[{key:"empty",value:function(){this._index.length=0}},{key:"insert",value:function(e){this._sortData&&this._index.length>0?o(this._index,e,this._sortData):this._index.push(e)}},{key:"remove",value:function(e){if(this._sortData){r(this._index,e,this._sortData)}else this._index.splice(this._index.findIndex(function(t){return t._id===e._id}),1)}},{key:"values",value:function(){return this._index}}]),e}(),d=require("clone"),v=function(){function e(t,n){c(this,e),this._collection=t,this._data=n||{}}return l(e,[{key:"byId",value:function(t){var n=d(this._data,!1);return n.byId=t,new e(this._collection,n)}},{key:"count",value:function(){var t=d(this._data,!1);return t.count=!0,new e(this._collection,t)}},{key:"eq",value:function(e){return this.op("===",e)}},{key:"exec",value:function(){var e=this._data,n=void 0,i=!1;if(e.byId)n=[this._collection.get(e.byId)];else{if(e.sort){var r=e.sort.map(function(e){return e.key}).join(",");n=this._collection.values(r),n&&(i=!0)}n||(n=this._collection.values().slice()),e.filters&&e.filters.forEach(function(e){n=n.filter(e)}),e.wheres&&e.wheres.forEach(function(e){n=n.filter(function(t){switch(e.op){case">":return t[e.key]>e.value;case"<":return t[e.key]<e.value;case">=":return t[e.key]>=e.value;case"<=":return t[e.key]<=e.value;case"===":return t[e.key]===e.value;case"!==":return t[e.key]!==e.value}})}),!e.sort||e.count||i||t(n,e.sort),(e.limit||e.offset)&&(n=n.slice(e.offset||0,(e.offset||0)+(e.limit||n.length)))}return e.select&&(n=n.map(function(t){var n={_id:t._id};return e.select.forEach(function(e){return n[e]=t[e]}),n})),e.count?n.length:1===e.limit||e.byId?n[0]:n}},{key:"exists",value:function(){return this.op("!==",void 0)}},{key:"filter",value:function(t){var n=d(this._data,!1);return n.filters=n.filters||[],n.filters.push(t),new e(this._collection,n)}},{key:"gt",value:function(e){return this.op(">",e)}},{key:"gte",value:function(e){return this.op(">=",e)}},{key:"is",value:function(e){return this.eq(e)}},{key:"limit",value:function(t){var n=d(this._data,!1);return n.limit=t,new e(this._collection,n)}},{key:"lt",value:function(e){return this.op("<",e)}},{key:"lte",value:function(e){return this.op("<=",e)}},{key:"ne",value:function(e){return this.op("!==",e)}},{key:"neg",value:function(){return this.op("<",0)}},{key:"negative",value:function(){return this.neg()}},{key:"not",value:function(e){return this.ne(e)}},{key:"offset",value:function(t){var n=d(this._data,!1);return n.offset=t,new e(this._collection,n)}},{key:"one",value:function(){return this.limit(1)}},{key:"op",value:function(t,n){var i=d(this._data,!1);return i.wheres=i.wheres||[],i.wheres.push({key:i.key,value:n,op:t}),new e(this._collection,i)}},{key:"populate",value:function(){if(!this._collection.schema)throw new Error("Cannot populate document without a defined schema for '"+this._collection.schema+"'.");for(var t=d(this._data,!1),n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return t.populate=i,new e(this._collection,t)}},{key:"pos",value:function(){return this.op(">",0)}},{key:"positive",value:function(){return this.pos()}},{key:"select",value:function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if(-1!==n.indexOf("_id"))throw new Error("Document id is always included in the Document, no need to explicity select it.");if(!n.every(function(e){return"string"==typeof e}))throw new Error('All select keys must be of type "string".');var r=d(this._data,!1);return r.select=n,new e(this._collection,r)}},{key:"sort",value:function(){for(var t=d(this._data,!1),n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.sort=i(r),new e(this._collection,t)}},{key:"within",value:function(e,t){return this.op(">=",e).op("<=",t)}},{key:"where",value:function(t){var n=d(this._data,!1);return n.action="where",n.key=t,new e(this._collection,n)}}]),e}(),y=function(){function e(t,n,i){c(this,e),this._database=t,this.name=n,this.schema=i,this._documents={},this._indexes=f({},e._DEFAULT_INDEX,new h(e._DEFAULT_INDEX))}return l(e,[{key:"empty",value:function(){var e=this;this._documents={},Object.keys(this._indexes).forEach(function(t){e._indexes[t].empty()})}},{key:"find",value:function(){return new v(this)}},{key:"findOne",value:function(e){if(e&&"string"!=typeof e)throw new Error('The document is must be a "string", not a "'+(void 0===e?"undefined":u(e))+'".');return e?this.find().byId(e):this.find().limit(1)}},{key:"get",value:function(e){if("string"!=typeof e)throw new Error('The document id must be a "string", not a "'+("undefined"==typeof name?"undefined":u(name))+'".');if(e in this._documents)return this._documents[e]}},{key:"index",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=i(t),o=t.join(",");this._indexes[o]=new h(o,r)}},{key:"insert",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t._id)throw new Error("The document to be inserted has no '_id'.");if("string"!=typeof t._id)throw new Error('A document must have a "string" _id, not a "'+("undefined"==typeof name?"undefined":u(name))+'".');if(e._RESERVED.forEach(function(e){if(t._id===e)throw new Error("The document _id '"+t._id+"' is an internal reserved name and cannot be used.")}),t._id in this._documents){if(!i)throw new Error("The document _id '"+t._id+"' already exists within the '"+this.name+"' collection.");this.remove(t)}return this._documents[t._id]=t,Object.keys(this._indexes).forEach(function(e){n._indexes[e].insert(t)}),t}},{key:"list",value:function(){return Object.keys(this._documents)}},{key:"remove",value:function(e){var t=this;if(!e)throw new Error("No argument provided to remove from collection.");if(Array.isArray(e))e.forEach(function(e){t.remove(e)});else if("object"===(void 0===e?"undefined":u(e))&&"_id"in e)delete this._documents[e._id],Object.keys(this._indexes).forEach(function(n){t._indexes[n].remove(e)});else{if("string"!=typeof e)throw new Error('Incorrect argument provided to remove, must be either "string", "Document" or "Document[]", not "'+(void 0===e?"undefined":u(e))+'".');var n=this.get(e);n&&this.remove(n)}}},{key:"upsert",value:function(e){return this.insert(e,!0)}},{key:"values",value:function(t){return t?t in this._indexes?this._indexes[t].values():void 0:this._indexes[e._DEFAULT_INDEX].values()}}]),e}();y._DEFAULT_INDEX="__default",y._RESERVED=["_DEFAULT_INDEX","_RESERVED","name","schema","_database","_documents","_indexes","get","insert","list","upsert","values"];var _=function(){function e(t,n){c(this,e),this.name=t,this._collections={},this._options=n}return l(e,[{key:"collection",value:function(t,n){if("string"!=typeof t)throw new Error('The collection name must be a "string", not "'+(void 0===t?"undefined":u(t))+'".');if(e._RESERVED.forEach(function(e){if(t===e)throw new Error("Collection name '"+t+"' is an internal reserved name and cannot be used.")}),t in this._collections)throw new Error("A collection with name '"+t+"' already exists on database '"+this.name+"'.");var i=s(this,t,n);return this._collections[t]=i,i}},{key:"get",value:function(e){if("string"!=typeof e)throw new Error('The collection name must be a "string", "not a "'+(void 0===e?"undefined":u(e))+'".');if(e in this._collections)return this._collections[e];throw new Error("Collection name '"+e+"' has not been created and does not exist on database '"+this.name+"'.")}},{key:"list",value:function(){return Object.keys(this._collections)}}]),e}();_._RESERVED=["_RESERVED","name","_collections","_options","collection","get","list"];var m=function(){function e(){c(this,e),this.Database=_,this.Collection=y,this.Query=v,this._databases={}}return l(e,[{key:"create",value:function(t){if("string"!=typeof t)throw new Error('The database name must be a "string", not "'+(void 0===t?"undefined":u(t))+'".');if(e._RESERVED.forEach(function(e){if(t===e)throw new Error("Database name '"+t+"' is an internal reserved name and cannot be used.")}),t in this._databases)throw new Error("A database with name '"+t+"' already exists.");var n=a(t);return this._databases[t]=n,n}},{key:"get",value:function(e){if("string"!=typeof e)throw new Error('The database name must be a "string", not a "'+(void 0===e?"undefined":u(e))+'".');if(e in this._databases)return this._databases[e];throw new Error("Database name '"+e+"' has not been created and does not exist.")}},{key:"list",value:function(){return Object.keys(this._databases)}},{key:"reset",value:function(e){if(e){if("string"!=typeof e)throw new Error('The database name must be a "string", not a "'+(void 0===e?"undefined":u(e))+'".');if(!(e in this._databases))throw new Error("Database name '"+e+"' does not exist and cannot be reset.");delete this._databases[e]}else this._databases={}}}]),e}();return m._RESERVED=["Database","Collection","Query","_RESERVED","_databases","create","get","list","reset"],new Proxy(new m,{get:function(e,t){return t in e?e[t]:"string"==typeof t&&-1!==e.list().indexOf(t)?e.get(t):void 0},set:function(e,t,n){if(t in e)return e[t]=n,!0;throw new Error("Do not dynamically set values on MinDB.")}})}();
