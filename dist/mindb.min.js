var mindb=function(){"use strict";function e(e,t,n){var i=new s(e,t,n);return new Proxy(i,{get:function(e,t){return t in e?e[t]:"string"==typeof t&&-1!==e.list().indexOf(t)?e.get(t):void 0},set:function(e,t,n){if(t in e)return e[t]=n,!0;throw new Error("Do not dynamically set values on MinDB.Collection.")}})}function t(e,t){var n=new u(e,t);return new Proxy(n,{get:function(e,t){return t in e?e[t]:"string"==typeof t&&-1!==e.list().indexOf(t)?e.get(t):void 0},set:function(e,t,n){if(t in e)return e[t]=n,!0;throw new Error("Do not dynamically set values on MinDB.Database.")}})}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=require("clone"),a=function(){function e(t,n){i(this,e),this._collection=t,this._data=n||{}}return r(e,[{key:"byId",value:function(t){var n=o(this._data,!1);return n.byId=t,new e(this._collection,n)}},{key:"eq",value:function(e){return this.op("===",e)}},{key:"exec",value:function(){var e=this._data,t=void 0;return e.byId?t=[this._collection.get(e.byId)]:(t=this._collection.values(),e.filters&&e.filters.forEach(function(e){t=t.filter(e)}),e.wheres&&e.wheres.forEach(function(e){t=t.filter(function(t){switch(e.op){case">":return t[e.key]>e.value;case"<":return t[e.key]<e.value;case">=":return t[e.key]>=e.value;case"<=":return t[e.key]<=e.value;case"===":return t[e.key]===e.value;case"!==":return t[e.key]!==e.value}})}),e.sort&&(t=t.sort(function(t,n){var i=0;return e.sort.every(function(e){var r=t[e.key],o=n[e.key];return r===o||(i="number"==typeof r&&"number"==typeof o?(r-o)*e.order:(r>o?1:-1)*e.order,!1)}),i})),(e.limit||e.offset)&&(t=t.slice(e.offset||0,(e.offset||0)+(e.limit||t.length)))),1===e.limit||e.byId?t[0]:t}},{key:"exists",value:function(){return this.op("!==",void 0)}},{key:"filter",value:function(t){var n=o(this._data,!1);return n.filters=n.filters||[],n.filters.push(t),new e(this._collection,n)}},{key:"gt",value:function(e){return this.op(">",e)}},{key:"gte",value:function(e){return this.op(">=",e)}},{key:"limit",value:function(t){var n=o(this._data,!1);return n.limit=t,new e(this._collection,n)}},{key:"lt",value:function(e){return this.op("<",e)}},{key:"lte",value:function(e){return this.op("<=",e)}},{key:"ne",value:function(e){return this.op("!==",e)}},{key:"neg",value:function(){return this.op("<",0)}},{key:"negative",value:function(){return this.neg()}},{key:"not",value:function(e){return this.ne(e)}},{key:"offset",value:function(t){var n=o(this._data,!1);return n.offset=t,new e(this._collection,n)}},{key:"one",value:function(){return this.limit(1)}},{key:"op",value:function(t,n){var i=o(this._data,!1);return i.wheres=i.wheres||[],i.wheres.push({key:i.key,value:n,op:t}),new e(this._collection,i)}},{key:"populate",value:function(){if(!this._collection.schema)throw new Error("Cannot populate document without a defined schema for '"+this._collection.schema+"'.");for(var t=o(this._data,!1),n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return t.populate=i,new e(this._collection,t)}},{key:"pos",value:function(){return this.op(">",0)}},{key:"positive",value:function(){return this.pos()}},{key:"sort",value:function(){var t=o(this._data,!1);t.sort=[];for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return i.forEach(function(e){var n="-"===e[0]?-1:1;t.sort.push({key:e.replace(/(\-|\+)/g,""),order:n})}),new e(this._collection,t)}},{key:"within",value:function(e,t){return this.op(">=",e).op("<=",t)}},{key:"where",value:function(t){var n=o(this._data,!1);return n.action="where",n.key=t,new e(this._collection,n)}}]),e}(),s=function(){function e(t,n,r){i(this,e),this._database=t,this.name=n,this.schema=r,this._documents={}}return r(e,[{key:"empty",value:function(){this._documents={}}},{key:"find",value:function(){return new a(this)}},{key:"findOne",value:function(e){if(e&&"string"!=typeof e)throw new Error('The document is must be a "string", not a "'+(void 0===e?"undefined":n(e))+'".');return e?this.find().byId(e):this.find().limit(1)}},{key:"get",value:function(e){if("string"!=typeof e)throw new Error('The document id must be a "string", not a "'+("undefined"==typeof name?"undefined":n(name))+'".');if(e in this._documents)return this._documents[e]}},{key:"insert",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t._id)throw new Error("The document to be inserted has no '_id'.");if("string"!=typeof t._id)throw new Error('A document must have a "string" _id, not a "'+("undefined"==typeof name?"undefined":n(name))+'".');if(e._RESERVED.forEach(function(e){if(t._id===e)throw new Error("The document _id '"+t._id+"' is an internal reserved name and cannot be used.")}),!i&&t._id in this._documents)throw new Error("The document _id '"+t._id+"' already exists within the '"+this.name+"' collection.");return this._documents[t._id]=t,t}},{key:"list",value:function(){return Object.keys(this._documents)}},{key:"remove",value:function(e){var t=this;if(!e)throw new Error("No argument provided to remove from collection.");if("string"==typeof e)delete this._documents[e];else if(e instanceof Array)e.forEach(function(e){t.remove(e._id)});else{if("object"!==(void 0===e?"undefined":n(e)))throw new Error('Incorrect argument provided to remove, must be either "string", "Document" or "Document[]", not "'+(void 0===e?"undefined":n(e))+'".');this.remove(e._id)}}},{key:"upsert",value:function(e){return this.insert(e,!0)}},{key:"values",value:function(){var e=this;return Object.keys(this._documents).map(function(t){return e._documents[t]})}}]),e}();s._RESERVED=["_RESERVED","name","schema","_database","_documents","get","insert","list","upsert","values"];var u=function(){function t(e,n){i(this,t),this.name=e,this._collections={},this._options=n}return r(t,[{key:"collection",value:function(i,r){if("string"!=typeof i)throw new Error('The collection name must be a "string", not "'+(void 0===i?"undefined":n(i))+'".');if(t._RESERVED.forEach(function(e){if(i===e)throw new Error("Collection name '"+i+"' is an internal reserved name and cannot be used.")}),i in this._collections)throw new Error("A collection with name '"+i+"' already exists on database '"+this.name+"'.");var o=e(this,i,r);return this._collections[i]=o,o}},{key:"get",value:function(e){if("string"!=typeof e)throw new Error('The collection name must be a "string", "not a "'+(void 0===e?"undefined":n(e))+'".');if(e in this._collections)return this._collections[e];throw new Error("Collection name '"+e+"' has not been created and does not exist on database '"+this.name+"'.")}},{key:"list",value:function(){return Object.keys(this._collections)}}]),t}();u._RESERVED=["_RESERVED","name","_collections","_options","collection","get","list"];var c=function(){function e(){i(this,e),this.Database=u,this.Collection=s,this.Query=a,this._databases={}}return r(e,[{key:"create",value:function(i){if("string"!=typeof i)throw new Error('The database name must be a "string", not "'+(void 0===i?"undefined":n(i))+'".');if(e._RESERVED.forEach(function(e){if(i===e)throw new Error("Database name '"+i+"' is an internal reserved name and cannot be used.")}),i in this._databases)throw new Error("A database with name '"+i+"' already exists.");var r=t(i);return this._databases[i]=r,r}},{key:"get",value:function(e){if("string"!=typeof e)throw new Error('The database name must be a "string", not a "'+(void 0===e?"undefined":n(e))+'".');if(e in this._databases)return this._databases[e];throw new Error("Database name '"+e+"' has not been created and does not exist.")}},{key:"list",value:function(){return Object.keys(this._databases)}},{key:"reset",value:function(e){if(e){if("string"!=typeof e)throw new Error('The database name must be a "string", not a "'+(void 0===e?"undefined":n(e))+'".');if(!(e in this._databases))throw new Error("Database name '"+e+"' does not exist and cannot be reset.");delete this._databases[e]}else this._databases={}}}]),e}();return c._RESERVED=["Database","Collection","Query","_RESERVED","_databases","create","get","list","reset"],new Proxy(new c,{get:function(e,t){return t in e?e[t]:"string"==typeof t&&-1!==e.list().indexOf(t)?e.get(t):void 0},set:function(e,t,n){if(t in e)return e[t]=n,!0;throw new Error("Do not dynamically set values on MinDB.")}})}();
